<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Golang, Algorithm, Database" />










<meta name="description" content="回滚即使成长, 更高的要求是对极致和细节的追求">
<meta property="og:type" content="website">
<meta property="og:title" content="线上回滚日记 TEST">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="线上回滚日记 TEST">
<meta property="og:description" content="回滚即使成长, 更高的要求是对极致和细节的追求">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="线上回滚日记 TEST">
<meta name="twitter:description" content="回滚即使成长, 更高的要求是对极致和细节的追求">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>线上回滚日记 TEST</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">线上回滚日记 TEST</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">不断书写才可以成长</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/04/tx-07/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/04/tx-07/" itemprop="url">C++语言模块基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-04T19:08:13+08:00">
                2018-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/10/04/tx-07/" class="leancloud_visitors" data-flag-title="C++语言模块基础">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="C-细节探究"><a href="#C-细节探究" class="headerlink" title="C++细节探究"></a>C++细节探究</h3><ol>
<li><p>模板在编译的时候是怎么编译的?</p>
<ul>
<li><p>什么是模板？为什么会有模板？</p>
<p>继承和包含并不总是满足重用代码的需要。所以会有模板</p>
<p>C++的类模板是一种生成通用类声明的更好的方法。</p>
</li>
<li><p>模板怎么提供通用的类声明</p>
<p>方法是通过提供参数化类型，将类型名作为参数传给接收方来建立类或函数</p>
</li>
<li><p>函数模板和类模板的举</p>
</li>
</ul>
</li>
<li><p>零值比较</p>
<ul>
<li>bool: if(ok)</li>
<li>int: if(ok == 0)</li>
<li>pointer: if(ok == null)</li>
<li>float: if(ok &lt;= 1e-5 &amp;&amp; ok &gt;= -1e-5)</li>
</ul>
</li>
<li>sizeof 和 strlen的不同<ul>
<li>运算符 和 标准库函数</li>
<li>sizeof 可以运算任何类型的大小 strlen只能得到”\0”结尾的字符串的大小</li>
<li>sizeof的大小要提前指定好，因为在编译期间就要确定下来</li>
</ul>
</li>
<li>对象之间的复制(类默认赋值函数)<ul>
<li>可以赋值，当存在指针成员变量时，要提前的深拷贝</li>
<li>深拷贝和浅拷贝的区别</li>
</ul>
</li>
<li>static的作用<ul>
<li>全局静态变量 限制了变量的作用域，只能在本文件中被使用</li>
<li>局部静态变量 由于存储在静态区，延长了变量的使用时间，只有程序结束的时候，该变量的生命周期才结束。</li>
<li>修饰类成员(变量 和 函数) 所有的实例共有</li>
<li>满足函数在不同调用期的通信，满足不同类对象之间的通信-&gt; 单例模式</li>
<li>static的默认值是0</li>
</ul>
</li>
<li><p>结构体和类的区别</p>
<ul>
<li>结构体的默认访问权限是pubic 类是private</li>
</ul>
</li>
<li>malloc 和 new 的区别<ul>
<li>malloc和free 是标准库函数， new和delete是运算符</li>
<li>malloc分配空间后，不能吊起构造函数， free也不能吊起构造函数； new吊起构造函数， delete调起析构函数</li>
<li>malloc返回void指针， new返回对应类指针</li>
</ul>
</li>
<li>指针和引用的区别 <ul>
<li>引用只是给变量起了一个别名，不占内存空间。 指针是新分配了一个指针的空间</li>
<li>引用声明时必须初始化，指针可以先申明再初始化</li>
<li>引用只能指定一个变量，指针可以先指向一个变量，然后再指向另一个变量</li>
<li>引用必须指向一个变量的实体，指针可以是一个空指针</li>
</ul>
</li>
<li>宏定义和函数的区别<ul>
<li>宏定义在预编译时就替换了代码，相当于直接插入了代码，运行时不需要跳转；函数运行需要跳转</li>
<li>宏定义没有类型检查；函数有类型的检查</li>
</ul>
</li>
<li>宏定义和const的区别<ul>
<li>宏定义在预编译阶段；const在编译的阶段</li>
<li>宏没有类型检查； const有类型检查</li>
<li>没有分配空间，直接代码插入； const要占据内存空间</li>
</ul>
</li>
<li>宏定义和typedef的区别<ul>
<li>宏定义主要用于常量和复杂函数的表示；typedef主要用于类型的别名</li>
<li>编译前替换；typedef还是在编译期间</li>
</ul>
</li>
<li>宏定义和内联函数的区别<ul>
<li>内联函数也是函数，在编译期间起作用，也可以做类型检查</li>
<li>具有函数的重载等功能</li>
<li>内联函数可以作为类的成员函数使用类的保护成员和私有成员</li>
</ul>
</li>
<li>数组名和指针的区别<ul>
<li>可以将数组名理解为常量指针，所以没有自增和自减的操作</li>
<li>数组名传递给一般指针后就退化了，sizeof就计算不出整个数组的大小</li>
</ul>
</li>
</ol>
<h3 id="面向对象基础"><a href="#面向对象基础" class="headerlink" title="面向对象基础"></a>面向对象基础</h3><ol>
<li>三大特性<ul>
<li>封装性</li>
<li>继承性</li>
<li>k多态性</li>
<li>模板特性(c++)</li>
</ul>
</li>
<li>public/protected/private的区别<ul>
<li>public ，类的内部和外部都可以访问</li>
<li>protected，只有类的内部成员或者派生类中可以访问</li>
<li>private， 类的内部成员访问派生类内部不可以访问</li>
</ul>
</li>
<li>对象的存储空间<ul>
<li>非静态成员的数据类型大小之和</li>
<li>编译器额外加入的虚函数指针变量，指向虚表，虚表保存的是虚函数的地址的列表</li>
<li>还有一些对齐的padding</li>
</ul>
</li>
<li>空类的大小和有哪些成员函数？<ul>
<li>空类的大小为1字节</li>
<li>成员函数有：<ul>
<li>构造函数</li>
<li>析构函数</li>
<li>默认拷贝函数</li>
<li>默认赋值函数</li>
</ul>
</li>
</ul>
</li>
<li>构造函数和析构函数必须是基类指针吗？<ul>
<li>构造函数<ul>
<li>构造函数不能是虚函数，虚函数的作用在于通过子类的指针或引用来调用父类的那个成员函数。而构造函数是在创建对象时自己主动调用的，不可能通过子类的指针或者引用去调用。</li>
</ul>
</li>
<li>析构函数<ul>
<li>析构函数一般都要为虚函数，</li>
<li>只有当析构函数为虚函数时，delete调一个基类指针的类时，才会调起对应的子类的析构函数</li>
</ul>
</li>
</ul>
</li>
<li>构造函数和析构函数的调用顺序是？<ul>
<li>构造函数(从初始化列表的运行顺序可看出)<ul>
<li>基类构造函数：多层基类则先构造最上层的基类，依次向外，如果是多继承则从左到右</li>
<li>成员变量的构造函数： 先构造成员变量的构造函数，然后调用本类的构造函数</li>
<li>派生类的构造函数</li>
</ul>
</li>
<li>析构函数<ul>
<li>析构顺序与构造顺序相反</li>
</ul>
</li>
</ul>
</li>
<li>拷贝构造函数和赋值运算函数的区别？<ul>
<li>拷贝构造函数是函数，赋值运算符是运算符重载。</li>
<li>拷贝构造函数会生成新的对像，赋值运算符不会</li>
<li>在形参传递的时候是调用拷贝构造函数，因为生成了本地的新对象</li>
</ul>
</li>
<li>覆盖、隐藏和重载的区别<ul>
<li>重载，在相同的类或作用域下，当函数名相同，参数不同的情况就发生了函数的重载</li>
<li>覆盖，当虚函数在派生类中对虚函数进行了实现的时候，派生类的虚函数地址对原虚函数的地址进行了覆盖</li>
<li>隐藏，派生类本来是集成了基类的成员函数，当派生类又实现了基类函数，而且这个基类成员函数还不是虚函数的情况下，就会把基类成员函数给隐藏，不管参数时候相同。</li>
</ul>
</li>
<li>哪几种情况需要用到初始化列表<ul>
<li>初始化const成员</li>
<li>初始化一个reference成员</li>
<li>调用基类的构造函数，并且该函数需要参数</li>
<li>调用数据成员对象的构造函数，而该函数需要参数</li>
</ul>
</li>
</ol>
<h3 id="STL-标准模板库"><a href="#STL-标准模板库" class="headerlink" title="STL(标准模板库)"></a>STL(标准模板库)</h3><ol>
<li><p>Vector</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">定义：</span><br><span class="line">	<span class="built_in">vector</span>&lt;T&gt; vec;</span><br><span class="line">插入元素：</span><br><span class="line">	vec.push_back(T);</span><br><span class="line">	vec.insert(iterator, T);</span><br><span class="line">删除元素：</span><br><span class="line">	vec.pop_back();</span><br><span class="line">	vec.erase(iterator);</span><br><span class="line">修改元素:</span><br><span class="line">	vec[position] = T;</span><br><span class="line">遍历容器：</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> it = vec.begin(); it &lt; vec.end(); it++)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">其他：</span><br><span class="line">	vec.empty();</span><br><span class="line">	vec.size();</span><br><span class="line">	vec.capacity();</span><br><span class="line">	vec.begin();</span><br><span class="line">	vec.end();</span><br></pre></td></tr></table></figure>
<p>实现：</p>
<ul>
<li>线性表，数组实现：<ul>
<li>支持随机访问</li>
<li>插入删除操作需要大量的移动元素</li>
</ul>
</li>
<li>需要连续的物理存储空间</li>
<li>当空间不够及 size &lt; capacity 的时候，需要空间拓展*2</li>
</ul>
<p>迭代器失效：</p>
<ul>
<li>插入元素：<ul>
<li>尾后插入，当size &lt; capacity时， 首迭代器不失效，其他失效。 </li>
</ul>
</li>
</ul>
</li>
<li><p>map</p>
<p>实现：</p>
<ul>
<li>树状结构，插入和删除操作不需要数据的复制，不连续的内存空间</li>
<li>操作复杂度和树的高度相关</li>
</ul>
<p>红黑树的基本概念：</p>
<ul>
<li><p>红黑树是二叉排序树</p>
<ul>
<li>左子树的所有元素都比根节点小</li>
<li>右子树所有节点都比根节点大</li>
<li>左右子树也都是二叉排序树</li>
</ul>
</li>
<li><p>而且还要满足几点要求</p>
<ul>
<li>树中所有节点非黑即白</li>
<li>根节点必须是黑色</li>
<li>红色节点的子节点必须为黑</li>
<li>从根到NULL的任何路径上黑节点的数量必须相同</li>
</ul>
</li>
<li><p>查找时间都是O(logn)</p>
</li>
<li><p>红黑树节点的定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Color &#123;</span><br><span class="line">    red 	= <span class="number">0</span>;</span><br><span class="line">    black 	= <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RBTreeNode</span>&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">RBTreeNode</span>* <span class="title">left</span>, *<span class="title">right</span>, *<span class="title">parent</span>;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    Color col;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>相对于平衡二叉树，平衡性稍差但是旋转次数会降低</li>
<li>相对于普通的二叉查找树，平衡性要好，查找效率要高</li>
</ol>
</li>
</ul>
</li>
</ol>
<h3 id="编程基础"><a href="#编程基础" class="headerlink" title="编程基础"></a>编程基础</h3><ol>
<li>为什么会有C++，相对于C语言的升级在哪？<ul>
<li>添加了了面向对象编程</li>
<li>继承了C语言高效、简洁、快速和可移植的特点。</li>
<li>添加了泛型编程方法</li>
</ul>
</li>
<li>C/C++语言的历史发展和必要性</li>
<li>条件编译#ifdef, #else, #endif作用？<ul>
<li>通过#ifdef来判断，将某些具体的模块包括到要编译的内容 ，只判断之前是否有该宏定义</li>
<li>子程序前加#define DEBUG 用于程序调试</li>
<li>应对硬件的设置</li>
<li>条件编译可以减少被编译的语句</li>
</ul>
</li>
</ol>
<h3 id="编译和调试"><a href="#编译和调试" class="headerlink" title="编译和调试"></a>编译和调试</h3><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><h5 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h5><ul>
<li><p>宏定义的替换 <code>#define</code></p>
</li>
<li><p>条件编译语句过滤代码  <code>#ifdef</code></p>
</li>
<li><p>处理#include指令，插入对应的文件到指令的位置 <code>#include</code></p>
</li>
<li><p>过滤所有的注释的语句</p>
</li>
<li>添加行号和文件名标识</li>
<li>保留所有的#program编译器指令 <code>#program</code></li>
</ul>
<h5 id="编译-1"><a href="#编译-1" class="headerlink" title="编译"></a>编译</h5><ul>
<li>词法分析<ul>
<li>读取源程序的字符，生成词法单元序列</li>
</ul>
</li>
<li>语法分析</li>
<li>语义分析</li>
<li>中间语言生成 汇编</li>
<li>目标代码生成与优化 二进制代码</li>
</ul>
<h5 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h5><p> 各个源代码模块独立的被编译，然后将他们组整起来，组装的过程就是链接。将所有目标文件的代码段拼接到一起，然后将所有对符号地址的引用加以修正。</p>
<ul>
<li><p>静态链接</p>
<p>在编译时和静态库(lib<em>**</em>.a)链接在一起成为完成的程序。通常静态库就是对多目标文件(.o)文件的打包。细节：静态链接被用到的目标文件都会复制到最终生成的可执行文件中。这种方式的好处是在运行时，可执行文件已尽装载完毕，速度比较快。</p>
<p>静态文件是对多目标文件的打包，这里介绍些打包命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcc -c test1.c // 生成test1.c</span><br><span class="line">gcc -c test2.c // 生test2.c</span><br><span class="line">ar cr libtest.a test1.o test2.o</span><br></pre></td></tr></table></figure>
<p>在生成可执行文件需要使用到它的时候只需要在编译时加上即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o main main.c -ltest</span><br></pre></td></tr></table></figure>
</li>
<li><p>动态链接</p>
<p>多个程序都需要某个静态库，在每个程序中都需要拷贝一份，所以出现动态链接来解决这个问题。</p>
<p>首先打包成动态库，文件名为lib + 动态库名+ .so 后缀。编译时加上-fPIC选项，打包时加上-shared选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -c test1.c</span><br><span class="line">gcc -fPIC -c test2.c</span><br><span class="line">gcc -shared test1.o test2.o libtest.so</span><br></pre></td></tr></table></figure>
<p>使用动态链接的用法和静态链接相同</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o main main.c -ltest</span><br></pre></td></tr></table></figure>
</li>
<li><p>静态链接库和动态链接库的对比</p>
<ul>
<li>动态链接库运行时会先检查内存中是否存在该库的拷贝，若有则共享拷贝，标准模版库就是动态链接库。</li>
<li>动态链接库的升级更新很容易</li>
<li>静态链接库执行效率会比较高</li>
</ul>
</li>
<li><p>静态联编和动态联编的区别</p>
</li>
</ul>
<p>makefile编写</p>
<p>自动化编译的工具</p>
<ul>
<li><p>基本规则</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A:B</span><br><span class="line">(tab)&lt;command&gt;</span><br></pre></td></tr></table></figure>
<p>A是语句最后生成的文件，B是生成A所依赖的文件，比如生成test.o依赖test.c 和 test.h, 则写成 test.o:test.c test.h。接下来一行的开头必须是tab ，再往下就是实际的命令, 比如 gcc.c -c test.c -o test.o 。</p>
</li>
<li><p>变量</p>
<p>在文件中可以定义变量，在之后需要使用的时候只需要写一个$符号加上变量名即可。</p>
</li>
<li><p>自动寻找依赖</p>
<p>第一条目标即为编译输出的目标，程序会依次寻找依赖的关系，当依赖不存在时，贼寻找下面的生成目标形成隐形的依赖生成</p>
</li>
</ul>
<p>调试</p>
<p>符号解析</p>
<ul>
<li><p>可重定位目标文件 (relocatable file)</p>
<p>独立编译后的(.o)文件，其ELF文件格式包括：</p>
<ul>
<li>ELF头，指定文件的大小及字节序</li>
<li>.text， 代码段</li>
<li>.rodata, 只读数据区</li>
<li>.data，已初始化数据区</li>
<li>.bss，未初始化数据区</li>
<li>.symtab，符号表</li>
</ul>
</li>
<li><p>解析符号表</p>
<ul>
<li>将每个引用和文件中的符号表的一个符号定义联系起来</li>
</ul>
</li>
</ul>
<p>重定位</p>
<ul>
<li><p>合并节</p>
<p>多个可重定向目标文件中的相同的节合并成一个完整的聚合节，例如多个目标文件的.data节合并为可执行文件的.data节。</p>
</li>
<li><p>重定位符号引用</p>
<p>修改全部代码节和数据节对每个符号的引用，执行正确的运行时地址。</p>
</li>
</ul>
<h5 id="可执行目标文件"><a href="#可执行目标文件" class="headerlink" title="可执行目标文件"></a>可执行目标文件</h5><ul>
<li><p>ELF头部</p>
<p>描述文件的总体格式，并且包括程序的入口点，即第一条指令地址</p>
</li>
<li><p>段头部表</p>
<p>描述了可执行文件数据段、代码段等各段的大小、虚拟地址、段对其、执行权限等。通过段头部表描绘了虚拟存储器运行时存储映像，比如每个unix程序的代码段总从虚拟地址的Ox0804800开始。</p>
</li>
<li><p>其他段</p>
<p>和可重定位目标文件相同，但是完成了多个节的合并和重定位的工作</p>
</li>
</ul>
<h5 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h5><ul>
<li><p>克隆</p>
<p>新程序的执行首先要父进程fork()得到一个子进程，该子进程除了pid等标识不同其他基本均与父进程相同。</p>
</li>
<li><p>重新映射</p>
<p>当子进程执行自己的系统调用时，会先清空子进程现有的虚拟存储段(不再映射到父进程到各个段)，之后重新创建子进程虚拟存储器各段和可执行文件各段的映射。可理解为对复制进来的父进程页表进行重写，映射到外存中的各个段。</p>
</li>
<li><p>虚页调入</p>
<p>加载器跳转到入口地址_start开始执行程序，接下来的过程需要配合虚拟存储器来完成。CPU获得了指令的虚拟地址后，若该指令不再内存中，则从外存中调入。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/04/tx-09/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/04/tx-09/" itemprop="url">数据机构与算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-04T19:08:13+08:00">
                2018-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/10/04/tx-09/" class="leancloud_visitors" data-flag-title="数据机构与算法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="leetcode列表"><a href="#leetcode列表" class="headerlink" title="leetcode列表"></a>leetcode列表</h3><table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">题目</th>
<th style="text-align:center">代码</th>
<th style="text-align:center">解答</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">二叉搜索树的第k大节点</td>
<td style="text-align:center">😊</td>
<td style="text-align:center">😊</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">实现LRU内存模型</td>
<td style="text-align:center">😊</td>
<td style="text-align:center">😊</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">并查集实现最小生成树</td>
<td style="text-align:center">😊</td>
<td style="text-align:center">😊</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">最短路径算法</td>
<td style="text-align:center">🙂</td>
<td style="text-align:center">🙂</td>
</tr>
</tbody>
</table>
<p>解答：</p>
<ol>
<li><p>二叉搜索树的第K大节点</p>
<ul>
<li><p>解答：二叉搜索树的中序遍历有序的特点</p>
</li>
<li><p>代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">midTravelKthest</span><span class="params">(TreeNode* root, <span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    TreeNode* p = root;</span><br><span class="line">    <span class="built_in">stack</span>&lt;TreeNode*&gt; s;</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;   </span><br><span class="line">    <span class="keyword">while</span>(p || !s.empty())&#123;</span><br><span class="line">        <span class="keyword">if</span>(p)&#123;</span><br><span class="line">          s.push(p);</span><br><span class="line">          p = p-&gt;left;  </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            p = s.top();</span><br><span class="line">            s.pop();</span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">if</span> (count == k) &#123;</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; p-&gt;val &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p-&gt;right;</span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>实现LRU内存模型</p>
<ul>
<li><p>解答：</p>
<ul>
<li>get操作，先检查pos 优先级set里面是否有该元素，如果有则重新put该k-value。</li>
<li>put操作，先检查其中pos是否有该key，如果有，则erase该元素 通过iterator，如果没有，则检查元素的个数是否达到了capacity，如果到了就要将list队尾元素erase掉；最后统一的在队列最前面插入元素，并在pos中记录其位置</li>
</ul>
</li>
<li><p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LRU</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    LRU : capacity(<span class="keyword">int</span> ca)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Get</span><span class="params">(<span class="keyword">int</span> key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(pos.find(key) != pos.end())&#123;</span><br><span class="line">            Put(key, recent[pos[key].second]);</span><br><span class="line">            <span class="keyword">return</span> recent[pos[key]].second;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(pos.find(key) != pos.end())&#123;</span><br><span class="line">            recent.erase(pos[key]);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (pos.size() &gt;= capacity)&#123;</span><br><span class="line">            pos.erase(recent.back().first);</span><br><span class="line">            recent.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        recent.push_front(&#123;key, val&#125;);</span><br><span class="line">        pos[key] = recent.begin();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> capacity;</span><br><span class="line">    <span class="built_in">list</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; recent;</span><br><span class="line">    <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="built_in">list</span>&lt; pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; &gt;::iterator&gt; pos;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>并查集生成找到最小生成树</p>
<ul>
<li><p>标签：<strong>并查集</strong></p>
</li>
<li><p>解答：最小生成树，是将一个图形成一个连接分量，而这个连接分量的边的权值之和最小。采用贪心法，首先将边按权值大小进行排序。边按大小顺序进行连通，连通前检查该连通的头是否相同，即是否形成环，若形成环则取消该边的加入，若不形成环则将该边加入到连通分量，当连通了所有的点之后，则形成了左右的最小的生成树</p>
</li>
<li><p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//第一部分完成并查集类的设计</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnionFindSet</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    UnionFindSet(<span class="keyword">int</span> s)&#123;</span><br><span class="line">        size = s;</span><br><span class="line">        parents = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(<span class="number">-1</span>, s);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(parents[x] &lt; <span class="number">0</span>) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">return</span> parents[x] = Find(parents[x]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Union</span><span class="params">(<span class="keyword">int</span> root1, <span class="keyword">int</span> root2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root1 == root2) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(parents[root1] &lt; parents[root2])&#123;</span><br><span class="line">            parents[root2] = root1;</span><br><span class="line">            parents[root1] += <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            parents[root1] = root2;</span><br><span class="line">            parents[root2] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;    </span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; parents;</span><br><span class="line">    <span class="keyword">int</span> size;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> begin;</span><br><span class="line">    <span class="keyword">int</span> end;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;Edge&gt; krus(<span class="built_in">vector</span>&lt;Edge&gt; edges, <span class="keyword">int</span> n)&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;Edge&gt; res;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> cmp = [](Edge left, Edge right)&#123; <span class="keyword">return</span> left.val &gt; right.val&#125;;</span><br><span class="line">    priority_queue&lt;Edge, <span class="built_in">vector</span>&lt;Edge&gt;, <span class="keyword">decltype</span>(cmp)&gt; q(cmp);</span><br><span class="line">    </span><br><span class="line">    UnionFindSet ufs = <span class="keyword">new</span> UnionFindSet(n+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> edge : edges)&#123;</span><br><span class="line">        q.push(edge);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; n)&#123;</span><br><span class="line">		Edge temp = q.top();</span><br><span class="line">        q.pop();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(ufs.Find(temp.begin) == ufs.Find(temp.end))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           	ufs.Union(ufs.Find(temp.begin), ufs.Find(temp.end));</span><br><span class="line">           	res.push_back(temp);</span><br><span class="line">           	i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>最短路径算法-dijskra算法</p>
<p>标签：<strong>priority_queue</strong></p>
<p>解答：算法有几个辅助的存储，</p>
<ul>
<li>dis保存每个点到起点的距离的数组</li>
<li>vis记录是否拜访过</li>
<li>pre记录通过该点的上一个拜访点</li>
<li>priority_queue记录了可访问点的集合，保存的是pair&lt;dis, node_id&gt; 该点到起点的最小距离，通过优先级对列每次都将最小距离的点先拜访，这样就形成了最短路径，到该点的距离最短</li>
</ul>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dijkstra</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; temp;</span><br><span class="line">        temp = q.top();</span><br><span class="line">        q.pop();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>( vis[temp-&gt;second] != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">        vis[temp-&gt;second]++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= M; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(graph[temp-&gt;second][i] &lt; INT_MAX &amp;&amp; vis[i] != <span class="number">0</span> &amp;&amp; dis[i] &gt; dis[temp-&gt;second] + graph[temp-&gt;second][i])&#123;</span><br><span class="line">                dis[i] = dis[temp-&gt;second] + graph[temp-&gt;second][i];</span><br><span class="line">                pre[i] = temp-&gt;second;</span><br><span class="line">                q.push_back(make_pair(dis[i], i));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="错题集"><a href="#错题集" class="headerlink" title="错题集"></a>错题集</h3><table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">题目</th>
<th style="text-align:center">代码</th>
<th style="text-align:center">解答</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">清除注释代码</td>
<td style="text-align:center">😊</td>
<td style="text-align:center">😊</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">空缺的第一个正整数</td>
<td style="text-align:center">😢</td>
<td style="text-align:center">😢</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">数组组成最小的整数</td>
<td style="text-align:center">😭</td>
<td style="text-align:center">😭</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">Knight走棋的最小步骤</td>
<td style="text-align:center">🙂</td>
<td style="text-align:center">🙂</td>
</tr>
</tbody>
</table>
<ol>
<li><p>remove comments from a given c/c++ program</p>
<ul>
<li><strong>标签：c++, string</strong></li>
<li>解答：指定单行注释标示和多行注释标示，当处理流程为判断当前的是否处在注释期间，处理流程为：<ul>
<li>如果在单行注释区间，是否当了行尾</li>
<li>如果在多行注释区间，是否在多行注释结尾</li>
<li>如果在注释区间，当前字符丢弃</li>
<li>如果不在注释区间，而找到了单行注释的开头，改变单行注释的标示</li>
<li>不在注释区间，找到了多行注释的开头，改变多行注释的标示</li>
<li>如果不在注释区间，也没找到标示，则留下当前字符</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">removeComments</span><span class="params">(<span class="built_in">string</span> prgm)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = prgm.length();</span><br><span class="line">    <span class="built_in">string</span> res;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Flags to indicate that single line and multpile line comments</span></span><br><span class="line">    <span class="comment">// have started or not.</span></span><br><span class="line">    <span class="keyword">bool</span> s_cmt = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">bool</span> m_cmt = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Traverse the given program</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// If single line comment flag is on, then check for end of it</span></span><br><span class="line">        <span class="keyword">if</span> (s_cmt == <span class="literal">true</span> &amp;&amp; prgm[i] == <span class="string">'\n'</span>)</span><br><span class="line">            s_cmt = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If multiple line comment is on, then check for end of it</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>  (m_cmt == <span class="literal">true</span> &amp;&amp; prgm[i] == <span class="string">'*'</span> &amp;&amp; prgm[i+<span class="number">1</span>] == <span class="string">'/'</span>)</span><br><span class="line">            m_cmt = <span class="literal">false</span>,  i++;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If this character is in a comment, ignore it</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s_cmt || m_cmt)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check for beginning of comments and set the approproate flags</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (prgm[i] == <span class="string">'/'</span> &amp;&amp; prgm[i+<span class="number">1</span>] == <span class="string">'/'</span>)</span><br><span class="line">            s_cmt = <span class="literal">true</span>, i++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (prgm[i] == <span class="string">'/'</span> &amp;&amp; prgm[i+<span class="number">1</span>] == <span class="string">'*'</span>)</span><br><span class="line">            m_cmt = <span class="literal">true</span>,  i++;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If current character is a non-comment character, append it to res</span></span><br><span class="line">        <span class="keyword">else</span>  res += prgm[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Driver program to test above functions </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="built_in">string</span> prgm = <span class="string">"   /* Test program */ \n"</span></span><br><span class="line">                  <span class="string">"   int main()  \n"</span></span><br><span class="line">                  <span class="string">"   &#123;           \n"</span></span><br><span class="line">                  <span class="string">"      // variable declaration \n"</span></span><br><span class="line">                  <span class="string">"      int a, b, c;    \n"</span></span><br><span class="line">                  <span class="string">"      /* This is a test  \n"</span></span><br><span class="line">                  <span class="string">"          multiline     \n"</span></span><br><span class="line">                  <span class="string">"          comment for   \n"</span></span><br><span class="line">                  <span class="string">"          testing */      \n"</span></span><br><span class="line">                  <span class="string">"      a = b + c;       \n"</span></span><br><span class="line">                  <span class="string">"   &#125;           \n"</span>; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Given Program \n"</span>; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; prgm &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">" Modified Program "</span>; </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; removeComments(prgm); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>空缺的第一个正整数</p>
<ul>
<li><p>标签：array</p>
</li>
<li><p>解答：</p>
<ul>
<li>位图法：将每个正整数进行按顺序进行标记</li>
<li>转换位置法：将数据按其大小放到该放的位置上，速度上较快，缺点：当不是从0开始计数时，则需要先找到最大的数据</li>
<li>去重后的最小堆：将数据一个个放出，是否满足规则，但是比较慢</li>
</ul>
</li>
<li><p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">firstMissingPositive</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = nums.size();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(nums[i] != i + <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> v = nums[i];</span><br><span class="line">            <span class="comment">// 针对从0开始的第一个缺失的数，大于0的数据即可丢失</span></span><br><span class="line">            <span class="keyword">if</span>(v &gt; n || v &lt;= <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[v<span class="number">-1</span>] == v) <span class="keyword">break</span>;</span><br><span class="line">                swap(nums[v - <span class="number">1</span>], nums[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i] != i + <span class="number">1</span>) <span class="keyword">return</span> i +<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> n + <span class="number">1</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>数组组成最小的整数</p>
<p>标签: string</p>
<p>解法：理解比较算法，通过字符串大小的比较得到字符串相对的位置，最后将字符串的位置串起来就可以得到最后组成的最小的字符串，由于算法题需要证明字符串比较的各种延展和传递性，这里不展开比较。</p>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by zhanGGe on 2018/10/23.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> N;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; N;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; data_s(N, <span class="string">""</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)&#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; data_s[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N - i - <span class="number">1</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(data_s[i] &gt; data_s[i+<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="built_in">string</span> temp = data_s[i];</span><br><span class="line">                data_s[i] = data_s[i + <span class="number">1</span>];</span><br><span class="line">                data_s[i + <span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> res = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; N; i++)&#123;</span><br><span class="line">        res += data_s[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; res &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>反思：对string还是不是很熟悉，默认的库里已经对string的各种操作符进行了重载完全可以重新使用包括“+”， “&gt;”等等。对于剑指offer的题目的理解和练习漏洞太多了。</p>
</li>
<li><p>knight的最小步数</p>
<p>关键词： bfs</p>
<p>解析：当处理图中最小步数问题的时候，直接想到最短路劲问题，最短路径的实现实际上就是利用的bfs，分层去探索不同的路，当找到重点时反馈行走的步数，若队列都pop完了还是没找到，则不可能到达改点返回-1.</p>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by zhanGGe on 2018/10/23.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> moves[][<span class="number">2</span>] = &#123;&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, &#123;<span class="number">2</span>, <span class="number">1</span>&#125;, &#123;<span class="number">2</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">-2</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">-2</span>&#125;, &#123;<span class="number">-2</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">-2</span>, <span class="number">1</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">2</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pos</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">    pos(<span class="keyword">int</span> m, <span class="keyword">int</span> n)&#123;</span><br><span class="line">        x = m;</span><br><span class="line">        y = n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;pos&gt; q;</span><br><span class="line">    <span class="function">pos <span class="title">start</span><span class="params">(<span class="number">2</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    q.push(start);</span><br><span class="line">    <span class="keyword">int</span> D_x = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> D_y = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> M = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> N = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(start.x == D_x &amp;&amp; start.y == D_y) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        count++;</span><br><span class="line">        pos temp = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> move : moves)&#123;</span><br><span class="line">            <span class="keyword">int</span> x = temp.x + move[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">int</span> y = temp.y + move[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(x== D_x &amp;&amp; y == D_y)&#123;</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; count &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(x &gt;=<span class="number">0</span> &amp;&amp; x &lt; M &amp;&amp; y &gt;= <span class="number">0</span> &amp;&amp; y &lt; M)&#123;</span><br><span class="line">                q.push(pos(x, y));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="number">-1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>反思：</p>
<ul>
<li>对queue的几个操作还不熟悉<ul>
<li>front() 返回 队列的头</li>
<li>back() 返回队列的尾</li>
<li>push() 插入元素在尾部</li>
<li>pop() 在头部删除元素  </li>
</ul>
</li>
<li>对于图或者树的BFS的理解不够<ul>
<li>BFS肯定类似于层次遍历，肯定不能采用递归的方法，需要使用非递归加queue的方法去使用</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="动态规划专题"><a href="#动态规划专题" class="headerlink" title="动态规划专题"></a>动态规划专题</h4><ol>
<li><p>最长有效括号对</p>
</li>
<li><p>Unique Path II 有障碍物情况下，一点到另外一点的走法</p>
</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">题目</th>
<th style="text-align:center">解答</th>
<th style="text-align:center">代码</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">将数据尽量平均的分到两个数组</td>
<td style="text-align:center"><a href="#jump">🤣</a></td>
<td style="text-align:center">🤣</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<ol start="3">
<li><p>将数据尽量平均的分到两个数组</p>
<p>关键词： 动态规划</p>
<p>解答： 将数组尽量平均的分配到两个数组，可以转化为将数据放到zongzhizongzhi</p>
</li>
</ol>
<h4 id="海量数据处理"><a href="#海量数据处理" class="headerlink" title="海量数据处理"></a>海量数据处理</h4><h5 id="TopN的问题"><a href="#TopN的问题" class="headerlink" title="TopN的问题"></a>TopN的问题</h5><ol>
<li>海量数据中找到重复次数最多的一个</li>
</ol>
<h5 id="内存可以放下的TopN问题"><a href="#内存可以放下的TopN问题" class="headerlink" title="内存可以放下的TopN问题"></a>内存可以放下的TopN问题</h5><ol>
<li>快排降低排序数量</li>
<li>堆排序，保留topN</li>
</ol>
<h4 id="位图法"><a href="#位图法" class="headerlink" title="位图法"></a>位图法</h4><ol>
<li>在2.5亿数字中找出不重复的数字<ul>
<li>使用2-bit位图法，00表示不存在，01表示出现一次， 10表示出现多次，11表示无意义。这样需要1G内存</li>
<li>或者hash划分小文件，小文件使用hash_set检查各个元素，得到不重复的整数</li>
</ul>
</li>
<li>如何在40亿数字中判断是否有某个数<ul>
<li>位图法标记某个数是否存在，check标记数组</li>
</ul>
</li>
</ol>
<p><span id="jump">Hello World</span></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/28/tx-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/28/tx-06/" itemprop="url">Golang Read a UTF-8 text file with BOM</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-28T01:18:12+08:00">
                2018-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/09/28/tx-06/" class="leancloud_visitors" data-flag-title="Golang Read a UTF-8 text file with BOM">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Golang-Read-a-UTF-8-text-file-with-BOM"><a href="#Golang-Read-a-UTF-8-text-file-with-BOM" class="headerlink" title="Golang - Read a UTF-8 text file with BOM"></a>Golang - Read a UTF-8 text file with BOM</h2><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>开发中遇到一个上传文件的需求，通过规定上传的文件会将账号按行排列。 Bug复现为，当上传的文件是excel (Win)系产品导出的文件时，会在文首解析出不可显的字符，导致后端在解析时会校验错误。导致文件上传失败。 </p>
<p><img src="/2018/09/28/tx-06/bugs.png" alt="bugs"></p>
<p>用<code>vim -b ./file</code> 打开文件发现了文首的不可见字符 <code>\uFEFF</code>。搜索后才知道这个是UTF编码自带的编码顺序标记。所以本文接下来分别介绍下，1. BOM的详细信息，2. 以及我在golang的服务中是怎么处理这种兼容的状况的。</p>
<h4 id="BOM-bytes-order-marker"><a href="#BOM-bytes-order-marker" class="headerlink" title="BOM (bytes order marker)"></a>BOM (bytes order marker)</h4><p>From <a href="http://en.wikipedia.org/wiki/Byte_order_mark" target="_blank" rel="noopener">Wikipedia</a>, the byte order mark (BOM) is a Unicode character used to signal the endianness (byte order) of a text file or stream. It’s code point is U+FEFF. BOM use is optional, and, if used, should appear at the start of the text stream. 引用阮一峰老师的一段话：</p>
<blockquote>
<p>Unicode编码中表示字节排列顺序的那个文件头，叫做BOM（byte-order mark），FFFE和FEFF就是不同的BOM。</p>
<p>UTF-8文件的BOM是“EF BB BF”，但是UTF-8的字节顺序是不变的，因此这个文件头实际上不起作用。有一些编程语言是ISO-8859-1编码，所以如果用UTF-8针对这些语言编程序，就必须去掉BOM，即保存成“UTF-8—无BOM”的格式才可以，PHP语言就是这样。</p>
</blockquote>
<h4 id="big-endian-and-little-endian"><a href="#big-endian-and-little-endian" class="headerlink" title="big endian and little endian"></a>big endian and little endian</h4><p>对于大端模式和小端模式自己之前一直没弄明白，这里又碰见算是在熟悉一遍。再引用一遍阮老师的话做记忆：</p>
<blockquote>
<p>以汉字<code>严</code>为例，Unicode 码是<code>4E25</code>，需要用两个字节存储，一个字节是<code>4E</code>，另一个字节是<code>25</code>。存储的时候，<code>4E</code>在前，<code>25</code>在后，这就是 Big endian 方式；<code>25</code>在前，<code>4E</code>在后，这是 Little endian 方式。</p>
<p>这两个古怪的名称来自英国作家斯威夫特的《格列佛游记》。在该书中，小人国里爆发了内战，战争起因是人们争论，吃鸡蛋时究竟是从大头(Big-endian)敲开还是从小头(Little-endian)敲开。为了这件事情，前后爆发了六次战争，一个皇帝送了命，另一个皇帝丢了王位。</p>
<p>第一个字节在前，就是”大头方式”（Big endian），第二个字节在前就是”小头方式”（Little endian）。</p>
<p>那么很自然的，就会出现一个问题：计算机怎么知道某一个文件到底采用哪一种方式编码？</p>
<p>Unicode 规范定义，每一个文件的最前面分别加入一个表示编码顺序的字符，这个字符的名字叫做”零宽度非换行空格”（zero width no-break space），用<code>FEFF</code>表示。这正好是两个字节，而且<code>FF</code>比<code>FE</code>大<code>1</code>。</p>
<p>如果一个文本文件的头两个字节是<code>FE FF</code>，就表示该文件采用大头方式；如果头两个字节是<code>FF FE</code>，就表示该文件采用小头方式。</p>
</blockquote>
<p>从大头敲开，自然是先存前面字节再存后面， 从小头敲开自然是先存吃后面字节在吃前面。 这个问题又让自己重新规整了一下在操作系统中的字节序和网络通信中的字节序的不同：</p>
<ol>
<li>x86 CPU 一般都是小端字节序</li>
<li>TCP/IP中规定采取大端字节序</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="comment">// 判断系统是大端系统还是小端系统</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> x = <span class="number">0x12345678</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (*(<span class="keyword">char</span> *)&amp;x == <span class="number">0x78</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"little-endian.\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (*(<span class="keyword">char</span> *)&amp;x == <span class="number">0x12</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"big-endian\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"confused.\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于系统提供的主机和网络的字节序转换，留坑待填。</p>
<h4 id="Golang-解决方案"><a href="#Golang-解决方案" class="headerlink" title="Golang 解决方案"></a>Golang 解决方案</h4><p>我们采用的解决方案也比较的简单，就是当发现BOM时，将第一行的BOM给去掉。代码上使用了golang的strings去替换。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"bufio"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"os"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// FEFF because this is the Unicode char represented by the UTF-8 byte order mark (EF BB BF)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span>&#123;</span><br><span class="line">	b, err := os.Open(<span class="string">"./src/puin.csv"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	scanner := bufio.NewScanner(b)</span><br><span class="line">	</span><br><span class="line">	scanner.Scan()</span><br><span class="line">	firstline := scanner.Text()</span><br><span class="line">	firstline = strings.Replace(firstline, <span class="string">"\uFEFF"</span>, <span class="string">""</span>, <span class="number">-1</span>)</span><br><span class="line">	fmt.Println(firstline)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> scanner.Scan()  &#123;</span><br><span class="line">		data := scanner.Text()</span><br><span class="line">		fmt.Println(data)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然也有一些更通用的方案在Java的生态环境。The <a href="http://commons.apache.org/io/api-release/org/apache/commons/io/input/BOMInputStream.html" target="_blank" rel="noopener">Apache IO Commons</a> provides some tools to handle this situation. The BOMInputStream class detects the BOM and, if required, can automatically skip it and return the subsequent byte as the first byte in the stream. 这里就不再赘述，先睡了。</p>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/28/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/28/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-28T01:17:38+08:00">
                2018-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/09/28/hello-world/" class="leancloud_visitors" data-flag-title="Hello World">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/15/network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/15/network/" itemprop="url">Optical Noc Thermal Aware Power Model</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-15T11:44:02+08:00">
                2018-08-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/08/15/network/" class="leancloud_visitors" data-flag-title="Optical Noc Thermal Aware Power Model">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>To the research of thermal-aware routing algorithm for optical NoC，a traffic-thermal co-simulation platform is necessary. The traditional optical NoC simulator gets the temperature distribution at first , then simulates the thermal-aware traffic activities. But more NoC simulators adopts the traffic-thermal co-simulation platform which is proposed by <strong>Shang et al.[5].</strong> Traffic-thermal co-simulation network platform for NoC integrated the traffic of network, power model and thermal model. During the simulation, the NoC simulator do traffic activities with the adaptive routing algorithm. The power model generate the power consumption based on the traffic activites, which is a power trace file. Thermal model gets the power trace infoomation. The thermal model updates temprature dsitributions with the given power trace file.   So the thermal-aware adaptive routing algorithm adjust the network traffic based on the newer temprature distributions of the optical NoC system.</p>
<p>We proposed a traffic-thermal co-simulation platform for the research of thermal-aware routing algorithm for optical NoC.</p>
<h2 id="A-Traffic-thermal-Co-simulation-platform"><a href="#A-Traffic-thermal-Co-simulation-platform" class="headerlink" title="A Traffic-thermal Co-simulation platform"></a>A Traffic-thermal Co-simulation platform</h2><p>The proposed traffic-thermal co-simulaiton platform mainly consist of three parts: the optical network model, the learning based routing model and traffic-thermal co-simulation model. The optical network model is a SystemC-based cycle-accurate network simulator for optical NoC. The learning based routing model is the adaptive routing algorithm we proposed. We also implement a thraffic-thermal co-simulation platform for our optical NoC model. In our proposed work <strong>before[],</strong> we have introduced the optical network model  in detail. So in this section, we will first breify introduce the structure of the learning based routing model which is adopted in the router of network. Then we will describe the structure of traffic-therml co-simulation platform.</p>
<ol>
<li><p>The structrue of learning based rouitng model</p>
<p>We integrate the learning-based routing model in our optical NoC. When router model receive loss packets from other nodes, L-value calculator will caculate loss value based on the input loss packet and the optical thermal model. Then L-value update the corresponding the L-value in the L-Table as the algorithm which has been proposed in <strong>Section 3</strong>. When data packets is received from other nodes or processor, the Arbiter Unit will decide which port the packet go to as the input port and values in the L-Table. The arbiter unit will also send the loss packet at the same time. The whole strctrue of learning based routing model show as <strong>Figure[].</strong></p>
</li>
<li><p>The structrue of traffic-thermal co-simulation model</p>
<p>The traditional simulation model computes steady temperatures in HotSpot with the power trace hased been produced before, then simulate traffic activities in the optical network model with the steady temperatures. The problem of  traditioanl simulation is that the network simulator cannot update the tempeture distribution during the network simulation. Therefore, traditional simulation is unused for verifying thermal-aware designs for optical  NoC. A traffic-thermal co-simulation model is more suitable for verifying thermal-aware design. The whole traffic-thermal co-simulaiton model we proposed is showed as <strong>Figure[]</strong>. The optical NoC network simulator computes a period of traffic and transfer the power trace to the tempature model. The power trace is produced by the power model of the network. Then temprature model of Hotspot update the temprature distribution of the network with the power trace. The whole co-simulaton platform forms a loop between optical network and Hotspot temperature simulation. So the co-simualtion update the temperature distribution during the network simulation. It is necessary for the research of thermal-aware designs for optical NoC. </p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/02/tx-05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/02/tx-05/" itemprop="url">协程间的通道 -- 线上回滚日记(5)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-02T10:42:21+08:00">
                2018-07-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/07/02/tx-05/" class="leancloud_visitors" data-flag-title="协程间的通道 -- 线上回滚日记(5)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="协程间的通道-–-线上回滚日记-5"><a href="#协程间的通道-–-线上回滚日记-5" class="headerlink" title="协程间的通道 – 线上回滚日记(5)"></a>协程间的通道 – 线上回滚日记(5)</h2><ol>
<li><p>概念</p>
<p>通道实际上是类型化的消息队列：使得数据在协程间得以传输。</p>
</li>
<li><p>通信操作符</p>
<ol>
<li>ch &lt;- int1 表示：用通道ch发送变量int1</li>
<li>int2 = &lt;- ch</li>
</ol>
</li>
<li><p>默认情况下通道是同步且无缓冲的</p>
</li>
<li><p>通道阻塞</p>
<ol>
<li>同一个通道。接受操作是阻塞的，直到发送者可用；</li>
<li>同一个通道，发送操作也是阻塞的，直到接受着消费了通道内的数据</li>
</ol>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/tx-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/tx-4/" itemprop="url">Go 锁同步</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T22:05:18+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/06/22/tx-4/" class="leancloud_visitors" data-flag-title="Go 锁同步">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Go中多线程-锁和sync包-—-线上回滚日记4"><a href="#Go中多线程-锁和sync包-—-线上回滚日记4" class="headerlink" title="Go中多线程(锁和sync包) — 线上回滚日记4"></a>Go中多线程(锁和sync包) — 线上回滚日记4</h2><p>Go语言中是通过sync包中的mutex实现多线程的锁机制</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/22/tx-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/22/tx-3/" itemprop="url">regex in Golang -线上回滚日记 3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-22T01:34:35+08:00">
                2018-06-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/06/22/tx-3/" class="leancloud_visitors" data-flag-title="regex in Golang -线上回滚日记 3">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="regexp-包"><a href="#regexp-包" class="headerlink" title="regexp 包"></a>regexp 包</h2><p>上几节的内容中对正则有了初步的了解。只有不断的训练才会加深印象，当项目中碰到时，才可以有余力去完成项目中的挑战。</p>
<ul>
<li><p>简单模式： 使用<code>Match</code>方法便可：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ok, _ := regexp.Match(pat, []<span class="keyword">byte</span>(searchIn))</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用Compile方法，返回Regexp对像，匹配符合模式的字符串对象，指定re对象的方法</p>
</li>
</ul>
<h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"strconv"</span></span><br><span class="line">   <span class="string">"regexp"</span></span><br><span class="line">   <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   SearchIn := <span class="string">"John: 2578.34 William: 4567.23 Steve: 5632.18"</span></span><br><span class="line">   pat := <span class="string">"[0-9]+.[0-9]+"</span></span><br><span class="line"></span><br><span class="line">   f := <span class="function"><span class="keyword">func</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">      v, _ := strconv.ParseFloat(s, <span class="number">32</span>)</span><br><span class="line">      <span class="keyword">return</span> strconv.FormatFloat(v*<span class="number">2</span>, <span class="string">'f'</span>, <span class="number">2</span>, <span class="number">32</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> ok, _ := regexp.Match(pat, []<span class="keyword">byte</span>(SearchIn)); ok &#123;</span><br><span class="line">      fmt.Println(<span class="string">"Match Found!"</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   re, _ := regexp.Compile(pat)</span><br><span class="line"></span><br><span class="line">   str := re.ReplaceAllString(SearchIn, <span class="string">"##.#"</span>)</span><br><span class="line">   fmt.Println(str)</span><br><span class="line">   str2 := re.ReplaceAllStringFunc(SearchIn, f)</span><br><span class="line">   fmt.Println(str2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/07/tx-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/tx-01/" itemprop="url">线上回滚笔记-01</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T23:54:33+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/06/07/tx-01/" class="leancloud_visitors" data-flag-title="线上回滚笔记-01">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Linux-常用shell-指令"><a href="#Linux-常用shell-指令" class="headerlink" title="Linux 常用shell 指令"></a>Linux 常用shell 指令</h2><p>​    线上回滚笔记的第一篇，记一下这些天碰到和学到的Linux指令。入职以来，碰到很多开发环境和系统工具的学习和适应的过程，在越来越讲究效率的工程团队，Linux指令的熟悉层度可以很大的提高效率。无论在包下发，还是在线上环境测试，Shell指令，都可以很大的提升效率。</p>
<ul>
<li><h4 id="线上服务更新Shell指令"><a href="#线上服务更新Shell指令" class="headerlink" title="线上服务更新Shell指令"></a>线上服务更新Shell指令</h4></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">svr=`ps aux |grep <span class="string">'sso_proxy'</span> |grep -v grep | awk <span class="string">'&#123;print $2&#125;'</span> |wc -l`</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$svr</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">source</span> /etc/profile</span><br><span class="line"> 	/usr/<span class="built_in">local</span>/services/TSF3-PHP7-1.0/runtime/php/bin/php /data/web_deployment/svr/tsf2/sso_proxy_tcp/Start.php &amp;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    ps aux |grep <span class="string">'sso_proxy_tcp-master'</span> |grep -v grep | awk <span class="string">'&#123;print $2&#125;'</span> | xargs  <span class="built_in">kill</span> -15</span><br><span class="line">    sleep 1</span><br><span class="line">    /usr/<span class="built_in">local</span>/services/TSF3-PHP7-1.0/runtime/php/bin/php /data/web_deployment/svr/tsf2/sso_proxy_tcp/Start.php &amp;</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>ps–Process Status(查看进程状态指令)</p>
<ul>
<li>ps aux 是常用指令兼容的效果比较高，使用BSD syntax显示所有进程的状态<ul>
<li>ax一起使用是列出所有的状态</li>
<li>u 做格式命令出现，表示输出采用面上用户的格式 </li>
<li>兼容性比较好 在mac上一样的输出</li>
</ul>
</li>
</ul>
</li>
<li><p>grep–Global Regular Expression Print (全局正则表达式指令) 并把匹配的行打印出来</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [option] pattren file</span><br></pre></td></tr></table></figure>
<ul>
<li><p>-v  == –revert-match 显示不包含匹配文本的所有行</p>
</li>
<li><p>正则</p>
<blockquote>
<ul>
<li>元字符 “ \b”, “.”, “*”, “\d”<ol>
<li>\bhi\b.*\bLucy\b 匹配hi单词 后不远有单词Lucy</li>
<li>0\d{2}-\d{8} 匹配0后面2个数字 + 连字符 + 后面8位数字</li>
</ol>
</li>
<li>常用的元字符 “^ 字符串的开始”、”$ 字符串的结束”、”\w 匹配数字或字母或下划线”、”\s 匹配任意空白符”、”. 匹配除换行符的任意字符”、 <ol>
<li>^\d{5,8}$ 匹配5到8位长度的字符串</li>
</ol>
</li>
<li>字符转义 –  www\.\.com = www..com</li>
<li>重复 –  * 重复0次或多次| + 重复1次或多次| ?  重复0次或1次|{n}重复那次| {n,} 重复n次或者更多 |{n,m}重读n次到m次<ol>
<li>Window\d+</li>
<li>^\w+</li>
</ol>
</li>
<li>字符集 – 建立自己的查找字符集进行匹配 [aeiou] 匹配一个元音字符 [.?!]匹配三个符号的任意一个 [0-9]等同于\d，[a-z0-9A-Z_]等同于\w<ol>
<li>(?0\d{2}[) -]?\d{8} </li>
</ol>
</li>
<li>分支条件–用|把不同的规则分隔开<ol>
<li>0\d{2}-\d{8}|0\d{3}-\d{7}</li>
<li>\(0\d{2}\)[-]?\d(8)|0\d{2}[-]?\d{8}</li>
</ol>
</li>
<li>分组规则–重复多个字符，用小括号指定子表达式，然后指定子表达式的重复次数<ol>
<li>(\d{1,3}\.){3}\d{1,3} ip地址的匹配格式，但存在不可能的IP地址</li>
<li>((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}</li>
</ol>
</li>
<li>反义– 查找不属于某个简单定义的字符类的字符 [\^x] 匹配除了x以外的任意字符[\^aeiou]匹配除了aeiou几个字符外的字符<ol>
<li>\S+ 匹配不包含空白符的字符串 </li>
<li>&lt;a/[/^-]+&gt;</li>
</ol>
</li>
<li>后向引用 – <strong>匹配这个子表达式的文本</strong>(也就是此分组捕获的内容)可以在表达式或其它程序中作进一步的处理，后向引用用于重复搜索前面某个分组匹配的文本。例如，\1代表分组1匹配的文本。</li>
<li>零宽断言 – 用于指定一个位置，这个位置应该满足一定的条件<ol>
<li>\b\w+(?=ing\b) 用于匹配以ing结尾的ing前面的一部分<br> .  (?&lt;=\bre)\w+\b 用于匹配re开头的单词的后一部分    </li>
</ol>
</li>
</ul>
</blockquote>
</li>
<li><p>-h 只显示抓出来的行的内容，不显示文件名</p>
</li>
<li><p>-e 指定pattern</p>
</li>
<li><p>-l  只显示抓到指定模式内容的文件名</p>
</li>
<li><p>-n 显示抓到的文件的行数</p>
</li>
</ul>
</li>
<li><p>tcpdump — 抓包， 抓取网络中的通信包</p>
<ol>
<li>tcp ucp 指定抓包的类型</li>
<li>host port 指定抓包的host或者端口号port</li>
<li>-X 指定打印包的格式 详细的包内容</li>
<li>-i  指定网卡</li>
</ol>
<p>​    </p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/07/tx-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mark Zhan Zha">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="线上回滚日记 TEST">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/tx-02/" itemprop="url">线上回滚笔记-02</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T23:54:33+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/06/07/tx-02/" class="leancloud_visitors" data-flag-title="线上回滚笔记-02">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="DSN-Data-source-name-初探"><a href="#DSN-Data-source-name-初探" class="headerlink" title="DSN(Data source name)  初探"></a>DSN(Data source name)  初探</h2><p>​    最近的服务需要到MySql中进行增删查改，数据库一直是自己的弱项，碰巧这个机会，好好补补这方面的知识点。第一步，链接数据库的地址，ip地址、端口、账号、密码和数据库名都给你了，怎么去组织这些字段，当然google都会有答案，更好的方式是彻底的理解。</p>
<p>​    维基百科(<a href="https://en.wikipedia.org/wiki/Data_source_name),给出的答案是：In" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Data_source_name),给出的答案是：In</a> <a href="https://en.wikipedia.org/wiki/Computing" target="_blank" rel="noopener">computing</a>, a <strong>data source name</strong>  is a string that has an associated <a href="https://en.wikipedia.org/wiki/Data_structure" target="_blank" rel="noopener">data structure</a> used to describe a connection to a data source. 并且主要用于开放数据库的连接和Java数据库的连接。从用途和语言的角度，DSN的形式千变万化，但是主要作用都是对数据源进行连接，数据源可以是文件、数据库、系统和用户等。也可以在任意的语言形式中使用。</p>
<p>The Data Source Name has a common format, like e.g. <a href="http://pear.php.net/manual/en/package.database.db.intro-dsn.php" target="_blank" rel="noopener">PEAR DB</a> uses it, but without type-prefix (optional parts marked by squared brackets):</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[username[:password]@][protocol[(address)]]/dbname[?param1=value1&amp;...&amp;paramN=valueN]</span><br></pre></td></tr></table></figure>
<p>A DSN in its fullest form:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:password@protocol(address)/dbname?param=value</span><br></pre></td></tr></table></figure>
<p>Except for the databasename, all values are optional.</p>
<p>常用实例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user@unix(/path/to/socket)/dbname?charset=utf8</span><br><span class="line">user:password@tcp(localhost:5555)/dbname?charset=utf8</span><br><span class="line">user:password@/dbname</span><br><span class="line">user:password@tcp([de:ad:be:ef::ca:fe]:80)/dbname</span><br></pre></td></tr></table></figure>
<p>Ref: <a href="https://github.com/go-sql-driver/mysql" target="_blank" rel="noopener">https://github.com/go-sql-driver/mysql</a> </p>
<h2 id="使用MySQL数据库"><a href="#使用MySQL数据库" class="headerlink" title="使用MySQL数据库"></a>使用MySQL数据库</h2><p>go中使用mysql的基本方式, 包括增删查改。使用模式基本为：</p>
<ol>
<li>stmt, err := db.Prepare() 建立基本连接</li>
<li>res, err := stmt.Exec() 执行基本操作，输入参数填入第一步sql语句的洞中</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;database/sql&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	//&quot;time&quot;</span><br><span class="line"></span><br><span class="line">	_ &quot;github.com/go-sql-driver/mysql&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	db, err := sql.Open(&quot;mysql&quot;, &quot;astaxie:astaxie@/test?charset=utf8&quot;)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	//插入数据</span><br><span class="line">	stmt, err := db.Prepare(&quot;INSERT userinfo SET username=?,department=?,created=?&quot;)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	res, err := stmt.Exec(&quot;astaxie&quot;, &quot;研发部门&quot;, &quot;2012-12-09&quot;)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	id, err := res.LastInsertId()</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	fmt.Println(id)</span><br><span class="line">	//更新数据</span><br><span class="line">	stmt, err = db.Prepare(&quot;update userinfo set username=? where uid=?&quot;)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	res, err = stmt.Exec(&quot;astaxieupdate&quot;, id)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	affect, err := res.RowsAffected()</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	fmt.Println(affect)</span><br><span class="line"></span><br><span class="line">	//查询数据</span><br><span class="line">	rows, err := db.Query(&quot;SELECT * FROM userinfo&quot;)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	for rows.Next() &#123;</span><br><span class="line">		var uid int</span><br><span class="line">		var username string</span><br><span class="line">		var department string</span><br><span class="line">		var created string</span><br><span class="line">		err = rows.Scan(&amp;uid, &amp;username, &amp;department, &amp;created)</span><br><span class="line">		checkErr(err)</span><br><span class="line">		fmt.Println(uid)</span><br><span class="line">		fmt.Println(username)</span><br><span class="line">		fmt.Println(department)</span><br><span class="line">		fmt.Println(created)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//删除数据</span><br><span class="line">	stmt, err = db.Prepare(&quot;delete from userinfo where uid=?&quot;)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	res, err = stmt.Exec(id)</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	affect, err = res.RowsAffected()</span><br><span class="line">	checkErr(err)</span><br><span class="line"></span><br><span class="line">	fmt.Println(affect)</span><br><span class="line"></span><br><span class="line">	db.Close()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func checkErr(err error) &#123;</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Mark Zhan Zha" />
            
              <p class="site-author-name" itemprop="name">Mark Zhan Zha</p>
              <p class="site-description motion-element" itemprop="description">回滚即使成长, 更高的要求是对极致和细节的追求</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Zasy" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zasyzhang@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mark Zhan Zha</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count"></span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>







        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("g7knGrNdTfV0SCnSqeULRQ8k-gzGzoHsz", "75DKi86MPdh1w1ngVsrvHEUy");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "middleRight";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  

  

</body>
</html>
